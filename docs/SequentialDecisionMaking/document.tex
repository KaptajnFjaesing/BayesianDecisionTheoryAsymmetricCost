\documentclass[a4paper,12pt]{article}

\usepackage{amsmath}  % For equations
\usepackage{amsfonts} % For mathematical symbols
\usepackage{graphicx} % For figures
\usepackage{hyperref} % For links
\usepackage{appendix} % For appendices
\usepackage [round,authoryear] {natbib}

\DeclareMathOperator*{\argmax}{argmax}
\DeclareMathOperator*{\argmin}{argmin}

\usepackage{amsthm}
\usepackage{xcolor}

\usepackage{algorithm}
\usepackage{algpseudocode}


\newtheorem{exinn}{Example}
\newtheorem{theorem}{Theorem}
\newtheorem{definition}{Definition}



\title{Sequential Decision-Making for Inventory Control using Bayesian Decision Theory}
\author{Jonas Petersen \\ Ander Runge Walther }
\date{\today}

\begin{document}
	\maketitle
	
	\begin{abstract}
		Inventory control is a core aspect of supply chain management, balancing customer demand fulfillment against the costs of holding and ordering inventory. This paper addresses inventory management through the lens of Bayesian decision theory, enabling probabilistic decision-making under uncertainty. By establishing a framework for sequential decision-making over an infinite time horizon, an optimal solution tailored to a specific asymmetric cost function is derived, offering insights for practical implementations in inventory management.
	\end{abstract}
	
	\section{Introduction}
	Inventory management is a critical component of supply chain management that involves overseeing the ordering, storage, and use of a company's inventory, including raw materials, components, and finished goods. Effective inventory control ensures that a company has adequate stock to meet demand while minimizing costs associated with holding inventory. In practice, this often requires a balance between minimizing stockouts, which disrupt service levels, and limiting overstocking, which incurs unnecessary holding costs.
	
	The coordination of inventory and transportation decisions has gained significant attention over recent decades, driven by the need for specific practices like vendor-managed inventory (VMI), third-party logistics (3PL), and time-definite delivery (TDD) (see, e.g., \citep{CetinkayaLee2000, Alumur2012, Gurler2014}). These programs aim to optimize the balance between inventory holding costs and transportation costs. Traditional inventory models often assume immediate delivery to meet demand, yet this can be inefficient due to the fixed costs of transportation, prompting companies to adopt shipment consolidation policies that merge smaller demands into larger, less frequent shipments \citep{CetinkayaBookbinder2003, HigginsonBookbinder1994}.
	
	Three commonly implemented shipment consolidation policies—quantity-based, time-based, and hybrid—are particularly useful in improving cost efficiency by regulating shipment size or timing. Each policy type has distinct impacts on performance metrics, such as delay penalties, average inventory, and annual costs, guiding companies toward designing more efficient inventory-transportation systems \citep{Cetinkaya2005, Wei2020, Cetinkaya2006}.
	
	While these approaches provide valuable frameworks, they do not explicitly account for the uncertainties inherent in demand fluctuations or the associated asymmetric costs of overstocking and understocking. In settings where inventory decisions must be made sequentially, uncertainty can be more effectively managed through Bayesian decision theory, which offers a probabilistic approach to decision-making under uncertainty. This framework allows for more refined, sequential adjustments to inventory based on demand forecasting, which dynamically incorporates new data over time.
	
	In this study, Bayesian decision theory is utilized to address a sequential inventory control problem. Specifically, an optimal decision-making framework is derived based on a discounted asymmetric cost function, considering the impact of decisions made infinitely far into the future. Our model involves a decision-maker (henceforth referred to as the Robot) who manages stock levels over time in an interactive environment shaped by a random demand process. Through this setup, a mathematically rigorous and computationally feasible solution for optimal inventory decisions that account for uncertainty and asymmetric costs is derived.
	
	\section{Sequential Decision-Making Framework}
	To formalize the sequential decision-making problem, consider a stock management scenario in which the Robot makes decisions at each time step, interacting with an entity termed Nature, which represents environmental randomness~\citep{lavalle2006}. At each iteration $t$, the Robot decides on an action from its action space $\Omega_U$, while Nature removes a certain number of units from stock, denoted $s_t \in \Omega_S$. The goal is to manage the stock optimally, balancing the costs of overstocking ($N > 0$) and understocking ($N < 0$), given that each action taken has a probabilistic effect on the Robot’s objectives.
	
	The Robot’s decisions are based on historical data $D$, which contains past stock removals and other relevant demand features. Given an initial stock $N_0$, the stock level at time $t$ evolves according to
	\begin{equation}
		\begin{split}
			N_t &\equiv N_0 + \sum_{t'=1}^{t} (U_{t'-L} - s_{t'})\\
			& = N_0+\upsilon_t-\zeta_t
		\end{split},
	\end{equation}
	where $U_{t'-L}$ represents the decision made at an earlier time due to a potential lag $L$ and $\zeta_t\equiv \sum_{t'=1}^ts_{t'}$ and $\upsilon_t\equiv \sum_{t'=1}^tU_{t'-L}$. To support probabilistic decision-making, the Robot uses a forecast based on $D$ in the form
	\begin{equation}
		p(s_1, s_2, \dots | D, I),
	\end{equation}
	where $I$ denotes any additional background information~\citep{Sivia2006}. This probabilistic forecast, combined with the Robot's asymmetric cost function, guides the sequence of decisions over time.
	
	\section{Formulation of the Cost Function and Optimal Policy}
	The Robot’s objective is to formulate a sequence of decision rules, called a policy, $\xi = \{U_0(D), U_1(D), \dots\}$, where each $U_j(D) = u_j$ minimizes the expected cost
	\begin{equation}
		\xi^* = \arg \min_{\xi} \mathbb{E}[C | D, I],
	\end{equation}
	where the cost $C$ is assumed to be discounted viz
	\begin{equation}
		C = \sum_{t=1}^{\infty} \gamma_{\text{disc}}^{t} \left( h_t 1_{N_t> 0} + c_t (1_{N_t> 0}-1) \right)N_t,
		\label{eq:cost}
	\end{equation}
	where $\gamma_{\text{disc}} \in [0,1]$ is a discount factor, and $h$ and $c$ represent storage (holding) and understocking costs, respectively. The optimal decisions satisfy the first-order condition
	\begin{equation}
		\frac{d}{dU_m} \mathbb{E}[C | D, I] \Big|_{U_m = U_m^*} \overset{!}{=} 0 \quad \forall m,
		\label{eq:min_exp_cost}
	\end{equation}
	which leads to the optimal decision criterion (see Appendix~\ref{app:deriva} for derivation).
	
	\begin{theorem}[Optimal Policy Rule for Inventory Control]
		\label{theorem:opt_policy}
		Given the sequential decision-making framework and the asymmetric cost function in equation \eqref{eq:cost}, the optimal policy for the Robot at each time step $t$ is defined by
		\begin{equation}
			p(N_t^* > 0 | D, I) = \frac{c_t}{c_t + h_t},
			\label{eq:t1}
		\end{equation}
		where
		\begin{equation}
			N_t^* = N_0 +\upsilon_t^*-\zeta_t.
		\end{equation}
	\end{theorem}
	
	
	\section{Optimal Policy under Conditional Independence}
	Equation \eqref{eq:t1} can be written
	\begin{equation}
		\begin{split}
			p(N_t^* > 0 | D, I) &= \sum_{s_1,\dots s_t}1_{N_{t}\geq 0}p(s_1,\dots s_t|D,I)\sum_{s_{t+1},\dots}p(s_{t+1},\dots|s_1,\dots s_t,D,I)\\
			& = \sum_{\zeta_t=0}^{N_0+\Upsilon_t}p(\zeta_t|D,I)\sum_{s_{t+1},\dots}p(s_{t+1},\dots|\zeta_t,D,I)\\
		\end{split}
	\end{equation}
	Assuming conditional independence $p(s_{t+1},\dots|\zeta_t,D,I)=p(s_{t+1},\dots|D,I)$
	\begin{equation}
			p(N_t^* > 0 | D, I)  = \sum_{\zeta_t=0}^{N_0+\upsilon_t}p(\zeta_t|D,I).
			\label{eq:indep}
	\end{equation}
	Combining eqation \eqref{eq:indep} with theorem \ref{theorem:opt_policy} implies that the optimal policy is related to quantiles of $\zeta_t$ viz
	\begin{equation}
		\upsilon_t^* = Q_{\frac{c_t}{c_t+h_t}}\zeta_t-N_0,
		\label{eq:opt}
	\end{equation}
	where $Q_q(X)$ denotes the $q$-quantile of the random variable $X$. 
	
	\subsection{Policy Efficiency Ratio}
	In order to gauge the effect of using the optimal policy (equation \eqref{eq:opt}), the associated expected cost is compared to the expected cost associated to a baseline policy via the policy efficiency ratio (PER)
	\begin{equation}
		\text{PER}\equiv \frac{\mathbb{E}[C^*|D,I]}{\mathbb{E}[C'|D,I]},
	\end{equation}
	where $C^*$ is the cost function with the optimal policy and $C'$ is the baseline policy defined viz
	
	\begin{definition}[baseline policy]
		The baseline policy consists of ordering the expected value $\mathbb{E}[s_t|D,I]$ if $N_t<\mathbb{E}[s_t|D,I]$.
	\end{definition}
	
	The baseline policy represents an (R,Q) policy~\citep{bartmann1992inventory,axsaeter2006inventory} with the reorder point $N_t=0$ and batch quantity $\mathbb{E}[s_t|D,I]$. This policy is a simple approach to keeping the stock as close as possible to the reorder point while favoring a positive stock. Assuming i) $p(\zeta_t|D,I)$ follows a Poisson distribution and ii) $k_t=k,c_t=c$ are constant, the PER can be approximated (see appendix \ref{app:cer} for derivation) viz
	\begin{equation}
		\frac{\mathbb{E}[C^*|D,I] }{\mathbb{E}[C'|D,I]}\sim \frac{1}{1+\frac{2h}{c}}.
		\label{eq:per}
	\end{equation}
	Equation \eqref{eq:per} provides a rule of thumb to gauge the expected cost reduction by using the optimal policy (equation \eqref{eq:opt}) over a conventional approach. In typical industrial settings $c\gg h$ and so the expected reduction in cost will be modest, however, possibly still significant depending on the scale and elements included in the cost model. Figure \ref{fig:heatmap_analytical} show the PER (equation \eqref{eq:per}) plotted as a function of $h,c$.
	\begin{figure}[h!]
		\centering
		\includegraphics[width=\textwidth]{figures/analytical_heatmap.pdf}
		\caption{Heatmap of the analytical policy efficiency ratio (equation \eqref{eq:per}).}
		\label{fig:heatmap_analytical}
	\end{figure}
	
	
	\subsubsection{Example: Numerical Policy Efficiency Ratio}
	To provide an example of implementation (see source code on Github) and test equation \eqref{eq:per} on an anecdotal level, consider the case where $N_0=37$, $L =6$ and $U_j\in \mathbb{Z}$, $0\leq U_j\leq 0$ for any time step. Data are mocked from a Poisson distribution with rate parameter $\lambda =3$. $300$ random samples are drawn to represent a mock time series, with the last $52$ reserved as test data and the remaining as training data. Based on the training data, the $\lambda$ is estimated using MLE and based on a Poisson distribution with this estimated rate parameter, a forecast of dimensions (number\_of\_samples, forecast\_horizon), with number\_of\_samples=$5\,000$ and forecast\_horizon=$52$, is drawn. The optimal and baseline policies applied to yield decision over the forecast horizon. Using these decisions, the actual costs are computed using the test data. This is done $5\,000$ times to yield an estimate of the PER for a particular $h,c$. This process is repeated for $c\in \mathbb{Z}$, $1\leq c\leq 100$ and $h\in \mathbb{Z}$, $1\leq c\leq 20$, yielding the PERs shown in figure \ref{fig:heatmap_numerical}. Figure \ref{fig:heatmap_numerical} clearly show the same pattern as figure \ref{fig:heatmap_analytical}, however, with slight differences (as expected for an approximation); i) the maximum slightly exceeds $1$ and ii) the minimum significantly deviates from $0$. The former is likely due to random fluctuations from approximating the expected cost from $5\, 000$ samples. Increasing the sample size gradually brings the maximum closer to $1$. 
	
	========= TO THIS POINT ==========
	{\color{red} The latter? Is it an artefact, or due to numerical limitations? In the upper limit inaccuracy seems to be $\sim 0.04$. In the lower limit we have $\sim 0.2$... It can be inaccuracies of the approximation. I have defined the scale of the approximation based on deduction. Perhaps this is not perfectly accurate?}
	

	
	\begin{figure}[h!]
		\centering
		\includegraphics[width=\textwidth]{figures/numerical_heatmap.pdf}
		\caption{Heatmap of the numerical policy efficiency ratio calculated via simulation.}
		\label{fig:heatmap_numerical}
	\end{figure}
	


	
	\section{Conclusion}
	The derived decision rule offers a structured approach to managing inventory in a stochastic environment using Bayesian decision theory. The probabilistic framework accounts for demand uncertainty, guiding optimal actions based on expected costs. This work contributes to the field of inventory management by presenting an analytically derived solution, supporting practical applications in real-world inventory systems.
	
	\begin{enumerate}
		\item A few words on the intuitive interpretation of the cost function? The number of units overstocked multiplied with the cost of overstocking per unit. The number of units understocked multiplied with the value of each unit. The latter represents the lost value.
		\item Mention the benefit of the analytical solution; the computation speed relative to a numerical optimization is highly beneficial at scale.
		\item Compress the recursive relation to $m$-notation. 
		\item The baseline policy is an (R,Q) policy with $R =0$ and $Q = \mathbb{E}[s_t|D,I]$.
		\item Is our result in any of the inventory control books?
		\item will the relationship between baseline and optimal policy depend on forecasting method? I would say yes. How do we handle this?
		
		\item if there is around the same cost for over/under stocking, there is a $30-40\%$ reduction in costs with the optimal policy compared to the baseline. In the limit of $c\gg h$, the reduction in cost approach $0\%$ and the gains are minor. This is the relevant limit in most cases, where the value of the unit significantly outweigh the holding cost. This is relevant, however, it is underlined, that the baseline policy is always equal or worse (statistically, meaning the expected cost is always lower. Expected cost is over a distribution. draws from that distribution can fall either way) than the optimal policy. 
	\end{enumerate}
	
	\begin{enumerate}
		\item \href{https://www.academia.edu/27965536/Inventorycontroltextbook_140429044831_phpapp02_1_}{S. Axsäter. Inventory control}
		\item \href{https://proceedings.mlr.press/v151/kan22a/kan22a.pdf}{Gasthaus paper}
		\item \href{https://arxiv.org/pdf/2012.02392}{inspiration for introduction}
		\item \href{https://arxiv.org/pdf/2310.17168}{probabilistic trucks}
		\item \href{https://arxiv.org/pdf/2310.16096}{Amazon paper} (inspiration)
	\end{enumerate}
	
	\newpage
	\begin{appendices}
		\input{chapters/app_deriv.tex}
		\input{chapters/app_expected_cost.tex}
		\input{chapters/app_poisson.tex}
	\end{appendices}
	
	
	
	\bibliographystyle{plainnat}
	\bibliography{ref}
	
\end{document}